<mat-sidenav-container class="sidenav-container" (backdropClick)="closeSidenav()">

  <!-- Toolbar sidenav menu -->
  <mat-sidenav autoFocus="false" class="sidenav" mode="over">

    <!-- Pulsante chiusura sidenav -->
    <div>
      <mat-toolbar class="flex-start secondary-color-no-hover">
        <button mat-flat-button class="secondary-color" (click)="closeSidenav()">
          <mat-icon>arrow_back</mat-icon>
          <span class="label">Chiudi</span>
        </button>
      </mat-toolbar>
    </div>

    <mat-nav-list>

      <!-- Sport expansion panel -->
      <mat-accordion>
        <ng-container *ngFor="let sport of getSports(); let indexSport = index;" #panels>
          <mat-expansion-panel [expanded]="isPanelSportOpen(indexSport)" (opened)="openedPanelSportListener(indexSport)"
            (closed)="closedPanelSportListener();">
            <mat-expansion-panel-header class="expansion-panel-header-sport secondary-color mat-elevation-z3">
              <mat-panel-title>
                <div class="text" [ngClass]="isPanelSportOpen(indexSport) ? 'bold' : ''">
                  {{ sport.description }}
                </div>
              </mat-panel-title>
            </mat-expansion-panel-header>

            <!-- Lazy rendering -->
            <ng-template matExpansionPanelContent>
              <!-- Championship expansion panel per uno specifico sport -->
              <ng-container *ngFor="let championship of getChampionships(sport); let indexChamp = index;">
                <mat-expansion-panel [expanded]="false">
                  <mat-expansion-panel-header>
                    <mat-panel-title class="flex-center-wrap">
                      <div class="label no-margin">
                        {{ championship.description }}
                      </div>
                    </mat-panel-title>
                  </mat-expansion-panel-header>

                  <!-- Lazy rendering -->
                  <ng-template matExpansionPanelContent>
                    <!-- Elenco leghe per uno specifico sport e campionato -->
                    <ng-container *ngFor="let league of getLeagues(sport, championship)">
                      <mat-panel-description>
                        <ul class="full-width">
                          <li>
                            <a mat-list-item (click)="selectedLeagueListener(league);">
                              <span class="label link"> {{ league.name }} </span>
                            </a>
                          </li>
                        </ul>
                      </mat-panel-description>
                    </ng-container>
                  </ng-template>
                </mat-expansion-panel>
              </ng-container>
            </ng-template>
          </mat-expansion-panel>
        </ng-container>
      </mat-accordion>
    </mat-nav-list>
  </mat-sidenav>

  <!-- Contenuto toolbar -->
  <mat-sidenav-content>

    <mat-toolbar class="toolbar mat-elevation-z6 primary-color-dark">

      <!-- PRIMA RIGA (sempre visibile) -->
      <mat-toolbar-row class="toolbar-row" #toolbarFirstRow>

        <div class="full-width flex-center">

          <!-- pulsante apertura sidenav -->
          <div class="cell-1of12">
            <button mat-flat-button class="btn-menu btn-menu" (click)="openSidenav()">
              <mat-icon class="icon-size">menu</mat-icon>
              <span class="label">Sports</span>
            </button>
          </div>

          <!-- Pulsanti: Creazione team - Opzioni di ricerca - Lista giocatori -->
          <div class="flex-cell cell-4of12 flex-container" *ngIf="!(breakpointsService.mobileOrTabletObservable | async)">
            <ng-container *ngIf="isLeagueSelected()">

              <!-- Link alla pagina Create team -->
              <div class="cell-4of12 flex-center-wrap">
                <button mat-flat-button class="btn-menu "
                  [ngClass]="isCreateTeamLinkSelected() ? 'btn-menu-link' : 'primary-color-dark'"
                  (click)="goToPage(linkEnum.CREATE_TEAM)">
                  <span class="label" [ngClass]="isPageSelected(linkEnum.CREATE_TEAM) ? 'bold' : ''">
                    {{ linkEnum.CREATE_TEAM.description }}
                  </span>
                </button>
              </div>

              <!-- Link alla pagina Options -->
              <div class="cell-4of12 flex-center-wrap">
                <button mat-flat-button class="btn-menu "
                  [ngClass]="isPageSelected(linkEnum.OPTIONS) ? 'btn-menu-link' : 'primary-color-dark'"
                  (click)="goToPage(linkEnum.OPTIONS)">
                  <span class="label" [ngClass]="isPageSelected(linkEnum.OPTIONS) ? 'bold' : ''">
                    {{ linkEnum.OPTIONS.description }}
                  </span>
                </button>
              </div>

              <!-- link alla pagina Player list-->
              <div class="cell-4of12 flex-center-wrap">
                <button mat-flat-button class="btn-menu "
                  [ngClass]="isPageSelected(linkEnum.PLAYER_LIST) ? 'btn-menu-link' : 'primary-color-dark'"
                  (click)="goToPage(linkEnum.PLAYER_LIST)">
                  <span class="label" [ngClass]="isPageSelected(linkEnum.PLAYER_LIST) ? 'bold' : ''">
                    {{ linkEnum.PLAYER_LIST.description }}
                  </span>
                </button>
              </div>

            </ng-container>
          </div>

          <!-- Spazio vuoto / Home -->
          <div [ngClass]="(breakpointsService.mobileOrTabletObservable | async) ? 'cell-9of12' : 'cell-4of12'">
            <ng-container *ngIf="breakpointsService.mobileOrTabletObservable | async">
              <!-- Link alla pagina di Home -->
              <div class="flex-center-wrap">
                <button mat-flat-button (click)="goToPage(linkEnum.HOME)" class="btn-menu">
                  <h2 class="bold">FantasyTeam</h2>
                </button>
              </div>
            </ng-container>
          </div>

          <!-- Utente -->
          <div class="flex-end" [ngClass]="(breakpointsService.mobileObservable | async) ? 'cell-2of12' : 'cell-2of12'">

            <!-- Caso utente non autenticato: bottone apertura dialog -->
            <ng-container>
              <!-- Visualizzazione standard -->
              <button mat-flat-button class="btn-menu" *ngIf="!userLogged && !(breakpointsService.mobileObservable | async)"
                (click)="openLoginDialog()">
                <mat-icon class="icon-size">account_circle</mat-icon>
                <span class="label">Login</span>
              </button>

              <!-- Visualizzazione mobile -->
              <button mat-icon-button *ngIf="!userLogged && (breakpointsService.mobileObservable | async)" (click)="openLoginDialog()">
                <mat-icon class="icon-size">account_circle</mat-icon>
              </button>

            </ng-container>

            <!-- Caso utente autenticato: MenÃ¹ utente -->
            <ng-container *ngIf="userLogged">

              <!-- Visualizzazione standard -->
              <button mat-flat-button class="btn-menu full-width" *ngIf="!(breakpointsService.mobileObservable | async)"
                [matMenuTriggerFor]="menuUser">
                <mat-icon class="icon-size">account_circle</mat-icon>
                <span class="label">{{ user.username }}</span>
              </button>

              <!-- Visualizzazione mobile -->
              <button mat-mini-fab class="flat-mini-fab" *ngIf="(breakpointsService.mobileObservable | async)" [matMenuTriggerFor]="menuUser">
                {{ user.getShortUsername() }}
              </button>

              <!-- Menu -->
              <mat-menu #menuUser="matMenu" xPosition="before">
                <div class="user-menu">
                  <button mat-menu-item (click)="goToPage(linkEnum.USER_PROFILE)">
                    Mio profilo
                  </button>
                  <mat-divider></mat-divider>
                  <button mat-menu-item (click)="logout()">Logout</button>
                </div>
              </mat-menu>
            </ng-container>
          </div>

          <ng-container *ngIf="!(breakpointsService.mobileOrTabletObservable | async)">
            <div class="cell-1of12 flex-end flex-center-wrap">
              <!-- Link alla pagina di Home -->
              <button mat-flat-button (click)="goToPage(linkEnum.HOME)" class="btn-menu">
                <mat-icon class="icon-size">home</mat-icon>
                <span class="label">{{ linkEnum.HOME.description }}</span>
              </button>
            </div>
          </ng-container>

        </div>
      </mat-toolbar-row>

      <!-- SECONDA RIGA (visibile solo per mobile / tablet) -->
      <mat-toolbar-row *ngIf="(breakpointsService.mobileOrTabletObservable | async) && isLeagueSelected()" #toolbarSecondRow
        class="toolbar-row">

        <div class="full-width flex-container">

          <!-- Link alla pagina Create team -->
          <div class="cell-4of12 flex-center-wrap">
            <button mat-flat-button class="btn-menu "
              [ngClass]="isCreateTeamLinkSelected() ? 'btn-menu-link' : 'primary-color-dark'"
              (click)="goToPage(linkEnum.CREATE_TEAM)">
              <span class="label" [ngClass]="isPageSelected(linkEnum.CREATE_TEAM) ? 'bold' : ''">
                {{ linkEnum.CREATE_TEAM.description }}
              </span>
            </button>
          </div>

          <!-- Link alla pagina Options -->
          <div class="cell-4of12 flex-center-wrap">
            <button mat-flat-button class="btn-menu "
              [ngClass]="isPageSelected(linkEnum.OPTIONS) ? 'btn-menu-link' : 'primary-color-dark'"
              (click)="goToPage(linkEnum.OPTIONS)">
              <span class="label" [ngClass]="isPageSelected(linkEnum.OPTIONS) ? 'bold' : ''">
                {{ linkEnum.OPTIONS.description }}
              </span>
            </button>
          </div>

          <!-- link alla pagina Player list-->
          <div class="cell-4of12 flex-center-wrap">
            <button mat-flat-button class="btn-menu "
              [ngClass]="isPageSelected(linkEnum.PLAYER_LIST) ? 'btn-menu-link' : 'primary-color-dark'"
              (click)="goToPage(linkEnum.PLAYER_LIST)">
              <span class="label" [ngClass]="isPageSelected(linkEnum.PLAYER_LIST) ? 'bold' : ''">
                {{ linkEnum.PLAYER_LIST.description }}
              </span>
            </button>
          </div>

        </div>

      </mat-toolbar-row>
    </mat-toolbar>


    <!-- Spinner visualizzato in attesa che i dati della pagina siano caricati -->
    <mat-progress-spinner class="spinner" *ngIf="getLoadingDataObservable() | async" mode="indeterminate"
      diameter="150">
    </mat-progress-spinner>

    <!-- Contenuto della pagina -->
    <div [ngClass]="{'opacity-page' : getLoadingDataObservable() | async}">      
      <router-outlet></router-outlet>
    </div>
    
    <!-- Snack Bar message  -->
    <div *ngIf="isSnackBarVisibleObservable() | async" class="snack-bar-position">
      <app-custom-snackbar></app-custom-snackbar>
    </div>
  </mat-sidenav-content>
</mat-sidenav-container>